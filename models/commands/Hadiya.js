const remindedRecently = new Set();

module.exports.config = {
  name: "hadiya",
  version: "1.0.0",
  hasPermssion: 0,
  credits: "SaGor + AI",
  description: "à¦¹à¦¾à¦¦à¦¿à¦¯à¦¼à¦¾ à¦ªà¦°à¦¿à¦¶à§‹à¦§ à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯",
  commandCategory: "moderation",
  usages: "auto detect bad words",
  cooldowns: 5
};

// à¦¹à¦¾à¦¦à¦¿à¦¯à¦¼à¦¾à¦° à¦²à¦¿à¦¸à§à¦Ÿ (à¦¨à¦¿à¦œà§‡à¦° à¦®à¦¤à§‹ à¦•à¦°à§‡ à¦¬à¦¾à§œà¦¾à¦¤à§‡ à¦ªà¦¾à¦°à¦¬à§‡à¦¨)
const badWords = [
  "Bikash", "à¦¬à¦¿à¦•à¦¾à¦¶", "Nagad", "à¦¨à¦—à¦¦", "Rocket", "à¦°à¦•à§‡à¦Ÿ", "Nogod",
  "Bikas", "à¦Ÿà¦¾à¦•à¦¾ à¦ªà¦¾à¦ à¦¾à¦¬à§‹ à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦¦à¦¾à¦“", "à¦†à¦®à¦¿ à¦•à¦¿à¦›à§ à¦¦à¦¾à¦¨ à¦•à¦°à¦¤à§‡ à¦šà¦¾à¦‡", "à¦Ÿà¦¾à¦•à¦¾ à¦ªà¦¾à¦ à¦¾à¦¬à§‹", "à¦¬à¦¿à¦•à¦¾à¦¶ à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦¦à¦¾à¦“", "à¦¨à¦—à¦¦ à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦¦à¦¾à¦“", "à¦°à¦•à§‡à¦Ÿ à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦¦à¦¾à¦“", "à¦¹à¦¾à¦¦à¦¿à¦¯à¦¼à¦¾ à¦•à¦¿à¦­à¦¾à¦¬à§‡ à¦ªà¦¾à¦ à¦¾à¦¬à§‹", "à¦Ÿà¦¾à¦•à¦¾ à¦•à¦¿à¦­à¦¾à¦¬à§‡ à¦ªà¦¾à¦ à¦¾à¦¬à§‹"
];

module.exports.handleEvent = function({ api, event }) {
  try {
    const { threadID, messageID, senderID, body } = event;
    if (!body) return;

    const text = body.toLowerCase();

    // anti-spam (à¦à¦•à¦‡ à¦‡à¦‰à¦œà¦¾à¦°à¦•à§‡ 10 à¦¸à§‡à¦•à§‡à¦¨à§à¦¡à§‡ à¦à¦•à¦¬à¦¾à¦°à¦‡ à¦°à¦¿à¦ªà§à¦²à¦¾à¦‡ à¦¦à§‡à¦¬à§‡)
    const key = `${threadID}_${senderID}`;
    if (remindedRecently.has(key)) return;

    // bad word à¦†à¦›à§‡ à¦•à¦¿à¦¨à¦¾ à¦šà§‡à¦•
    if (!badWords.some(word => text.includes(word))) return;

    // à¦‡à¦‰à¦œà¦¾à¦°à§‡à¦° à¦¨à¦¾à¦® à¦¬à§‡à¦° à¦•à¦°à¦¿
    api.getUserInfo(senderID, (err, info) => {
      const userName = (!err && info && info[senderID]?.name) 
        ? info[senderID].name 
        : "à¦¬à¦¨à§à¦§à§";

      const responses = [
        `ðŸ•‹ ${userName},\n 01615101797\n à¦à¦‡ à¦¨à§‡à¦¨ à¦†à¦ªà¦¨à¦¾à¦° à¦¨à¦¾à¦®à§à¦¬à¦¾à¦°\n à¦…à¦¬à¦¶à§à¦¯à¦‡ à¦Ÿà¦¾à¦•à¦¾ à¦ªà¦¾à¦ à¦¾à¦¨à§‹à¦° à¦ªà¦°à§‡ à¦¶à§‡à¦·à§‡à¦° à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦à¦¬à¦‚ à¦¸à§à¦•à§à¦°à¦¿à¦¨à¦¶à¦Ÿ à¦¦à¦¿à¦¬à§‡à¦¨ ðŸ¥°`,
        `ðŸ•‹ ${userName}, \n 01615101797\n à¦à¦‡ à¦¨à§‡à¦¨ à¦†à¦ªà¦¨à¦¾à¦° à¦¨à¦¾à¦®à§à¦¬à¦¾à¦°\n à¦…à¦¬à¦¶à§à¦¯à¦‡ à¦Ÿà¦¾à¦•à¦¾ à¦ªà¦¾à¦ à¦¾à¦¨à§‹à¦° à¦ªà¦°à§‡ à¦¶à§‡à¦·à§‡à¦° à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦à¦¬à¦‚ à¦¸à§à¦•à§à¦°à¦¿à¦¨à¦¶à¦Ÿ à¦¦à¦¿à¦¬à§‡à¦¨ ðŸ¥°`,
        `ðŸ•‹ ${userName}, \n 01615101797\n à¦à¦‡ à¦¨à§‡à¦¨ à¦†à¦ªà¦¨à¦¾à¦° à¦¨à¦¾à¦®à§à¦¬à¦¾à¦°\n à¦…à¦¬à¦¶à§à¦¯à¦‡ à¦Ÿà¦¾à¦•à¦¾ à¦ªà¦¾à¦ à¦¾à¦¨à§‹à¦° à¦ªà¦°à§‡ à¦¶à§‡à¦·à§‡à¦° à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦à¦¬à¦‚ à¦¸à§à¦•à§à¦°à¦¿à¦¨à¦¶à¦Ÿ à¦¦à¦¿à¦¬à§‡à¦¨ ðŸ¥°`,
        `ðŸ•‹ ${userName}, \n 01615101797\n à¦à¦‡ à¦¨à§‡à¦¨ à¦†à¦ªà¦¨à¦¾à¦° à¦¨à¦¾à¦®à§à¦¬à¦¾à¦°\n à¦…à¦¬à¦¶à§à¦¯à¦‡ à¦Ÿà¦¾à¦•à¦¾ à¦ªà¦¾à¦ à¦¾à¦¨à§‹à¦° à¦ªà¦°à§‡ à¦¶à§‡à¦·à§‡à¦° à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦à¦¬à¦‚ à¦¸à§à¦•à§à¦°à¦¿à¦¨à¦¶à¦Ÿ à¦¦à¦¿à¦¬à§‡à¦¨ ðŸ¥°`
      ];

      // à¦°â€à§à¦¯à¦¾à¦¨à§à¦¡à¦® à¦°à¦¿à¦ªà§à¦²à¦¾à¦‡
      const msg = responses[Math.floor(Math.random() * responses.length)];

      api.sendMessage(msg, threadID, (sendErr) => {
        if (!sendErr) {
          try { api.setMessageReaction("ðŸ•‹", messageID, () => {}, true); } catch (e) {}
        }
      });
    });

    remindedRecently.add(key);
    setTimeout(() => remindedRecently.delete(key), 10000);

  } catch (e) {
    console.error("antiBadWord module error:", e);
  }
};

module.exports.run = function() {};
